<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>From Snowflake Servers to GitOps Nirvana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A beginner-friendly tour of the declarative stack that actually runs itself.">
  <meta name="keywords" content="GitOps,NixOS,Kubernetes,ArgoCD,Terraform,Docker,DSPy,OPA">
  <meta name="author" content="Jonathan McGuinness">
  <meta name="theme-color" content="#111827">

  <style>
    /* --- Base styles ------------------------------------------------------ */
    body {
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;
      line-height:1.6;
      margin:2rem auto;
      max-width:680px;
      padding:0 1rem;
      color:#ffffff;
      background:#111827;
    }
    h1,h2{color:#60a5fa;}
    table{width:100%;border-collapse:collapse;margin:1rem 0;}
    th,td{padding:.5rem;border:1px solid #374151;text-align:left;}
    code{background:#1f2937;padding:.15rem .35rem;border-radius:3px;}
    pre{background:#1f2937;padding:1rem;overflow-x:auto;}
    img{max-width:100%;height:auto;border-radius:6px;}
    a{color:#00ff00;}
    a:visited{color:#22c55e;}
    html{scroll-behavior:smooth;}

    /* --- Zoom-friendly SVG ------------------------------------------------ */
    .infra-svg{
      width:100%;
      height:auto;
      max-height:70vh;
      border-radius:6px;
      cursor:zoom-in;
      background:#111827;
      border:1px solid #374151;
      /* allow native pinch-zoom on touch devices */
      touch-action:manipulation;
    }
    /* dark-theme node & edge colours */
    .infra-svg .node rect,
    .infra-svg .node circle,
    .infra-svg .node polygon{
      fill:#111827;
      stroke:#60a5fa;
      stroke-width:2;
    }
    .infra-svg .edgePath .path{
      stroke:#00ff00;
      stroke-width:2;
    }

    /* --- Copy button ------------------------------------------------------ */
    #copyBtn{
      background:#00ff22;
      border:none;
      color:#111827;
      padding:.25rem .5rem;
      border-radius:4px;
      cursor:pointer;
      font-size:.9rem;
    }
  </style>
</head>

<body>
  <h1>From Snowflake Servers to GitOps Nirvana</h1>
  <p><em>A beginner-friendly tour of the declarative stack that actually runs itself ‚Äî 04 Aug 2025</em></p>

  <p>You‚Äôve probably heard the buzzwords: GitOps, NoOps, immutable infrastructure. Today I‚Äôd like to walk you‚Äîstep by step‚Äîthrough why these concepts exist and how a small constellation of tools (<a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a>, <a href="https://nixos.org/" target="_blank" rel="noopener">NixOS</a>, <a href="https://docker.com/" target="_blank" rel="noopener">Docker</a>, <a href="https://developer.hashicorp.com/terraform/" target="_blank" rel="noopener">Terraform</a>, <a href="https://kubernetes.io/" target="_blank" rel="noopener">Kubernetes</a>, <a href="https://argo-cd.readthedocs.io/en/stable/" target="_blank" rel="noopener">ArgoCD</a>, <a href="https://dspy.ai/" target="_blank" rel="noopener">DSPy</a>, and a pinch of <a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener">OPA</a> policy-as-code) fit together to create a platform that deploys itself every time you hit <i>merge</i>.</p>

  <hr>

  <h2>1. The Problem We‚Äôre Solving</h2>
  <p>In the old world, a server was a pet: lovingly hand-fed config files, patched on Sundays, and inevitably different from every other server. The result?</p>
  <ul>
    <li>‚ÄúIt works on my machine!‚Äù</li>
    <li>Snow-flake drift and 3 a.m. pages.</li>
    <li>Scaling = more pets.</li>
  </ul>

  <hr>

  <h2>2. The North Star: Everything as Code</h2>
  <p>Instead of pets, we want cattle‚Äîidentical, replaceable, and defined in text files that live in Git.</p>
  <p>If Git is the <i>single source of truth</i>, the rest of the stack becomes a conveyor belt that turns that truth into running software.</p>

  <hr>

  <h2>3. The Cast of Characters and Their Jobs</h2>
  <section>
    <h3>Reproducible Stack Cheat-Sheet</h3>
    <table>
      <thead>
        <tr><th>Tool</th><th>One-Sentence Job</th><th>Why It Matters</th></tr>
      </thead>
      <tbody>
        <tr><td><strong>Git</strong></td><td>The single source-of-truth for every line of code and config.</td><td>Immutable history + pull-requests = collaboration without chaos.</td></tr>
        <tr><td><strong>NixOS</strong></td><td>An entire Linux distro expressed in one declarative file.</td><td>Reinstalls laptop or 1 000-server fleet with <code>nixos-rebuild</code>.</td></tr>
        <tr><td><strong>Terraform</strong></td><td>Describe cloud resources (VPCs, disks, IAM) in HCL.</td><td>Re-creates an entire region from scratch in 15 min after a coffee spill.</td></tr>
        <tr><td><strong>Docker</strong></td><td>Bundle the app and its libraries into an immutable image.</td><td>Same artifact runs on your Mac, in CI, and in prod.</td></tr>
        <tr><td><strong>Argo CD</strong></td><td>A robot that watches Git and makes Kubernetes match it.</td><td>Manual <code>kubectl apply</code> is now a pull-request review.</td></tr>
        <tr><td><strong>Kubernetes</strong></td><td>The planet-scale scheduler that keeps those containers healthy.</td><td>Auto-heals, scales, and rolls out with zero downtime.</td></tr>
        <tr><td><strong>DSPy</strong></td><td>Prompt-engineering as typed, testable code.</td><td>Turns LLM prompts into reproducible pipelines.</td></tr>
        <tr><td><strong>OPA / Kyverno</strong></td><td>Policy-as-code gatekeepers for every API call.</td><td>Blocks <code>:latest</code> images or unencrypted buckets before they deploy.</td></tr>
      </tbody>
    </table>
  </section>

  <hr>

  <h2>4. How the Characters relate to Each Other</h2>
  <p>Table: A Declarative Software Architecture Workflow</p>

<!-- ========= Zoomable, vector-perfect flowchart ========= -->
<section id="flowchart-wrapper" style="position:relative">
  <!-- Zoom controls -->
  <div id="zoomCtl" style="margin:.25rem 0">
    <button id="zoomIn"  title="Zoom in">üîç+</button>
    <button id="zoomOut" title="Zoom out">üîç-</button>
    <button id="zoomFit" title="Fit to screen">‚§ß</button>
  </div>

  <!-- The SVG -->
  <svg id="flowchart"
       class="infra-svg"
       viewBox="0 0 2472 872"
       preserveAspectRatio="xMidYMid meet"
       xmlns="http://www.w3.org/2000/svg"
       aria-labelledby="ftitle">
    <title id="ftitle">Declarative GitOps workflow (full fidelity)</title>

    <!-- tiny CSS inside SVG for portability -->
    <style>
      .infra-svg{
        width:100%;
        max-height:70vh;
        background:#111827;
        border:1px solid #374151;
        border-radius:6px;
        cursor:grab;
        touch-action:manipulation;
      }
      .node rect{
        fill:#111827;
        stroke:#60a5fa;
        stroke-width:2;
      }
      .node text{
        fill:#fff;
        font:14px -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;
        text-anchor:middle;
        dominant-baseline:middle;
      }
      .edge{
        fill:none;
        stroke:#00ff00;
        stroke-width:2;
      }
      .edge-label{
        fill:#fff;
        font:12px -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;
        text-anchor:middle;
      }
      #zoomCtl button{
        background:#60a5fa;
        color:#111827;
        border:none;
        margin-right:.25rem;
        padding:.25rem .5rem;
        border-radius:4px;
        cursor:pointer;
      }
      #zoomCtl button:active{transform:scale(.95)}
    </style>

    <defs>
      <marker id="ah" viewBox="0 0 10 10" refX="9" refY="5"
              markerWidth="6" markerHeight="6" orient="auto">
        <path d="M0 0L10 5L0 10z" fill="#00ff00"/>
      </marker>
    </defs>

    <!-- ======  NODES  ====== -->
    <!-- 1st row -->
    <g class="node" transform="translate(2095 41)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Git Repository: single source of truth</text>
    </g>
    <g class="node" transform="translate(1301 199)">
      <rect x="-110" y="-22.5" width="220" height="45" rx="6"/>
      <text>NixOS host specs: flake.nix</text>
    </g>
    <g class="node" transform="translate(1559 199)">
      <rect x="-98" y="-22.5" width="196" height="45" rx="6"/>
      <text>Terraform infra: main.tf</text>
    </g>
    <g class="node" transform="translate(1823 199)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Dockerfiles &amp; image lockfiles</text>
    </g>
    <g class="node" transform="translate(2105 199)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Argo CD Apps &amp; Projects: YAML</text>
    </g>
    <g class="node" transform="translate(2367 199)">
      <rect x="-96" y="-22.5" width="192" height="45" rx="6"/>
      <text>DSPy pipelines: Python</text>
    </g>

    <!-- 2nd row -->
    <g class="node" transform="translate(1026 357)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>CI Pipeline: GitHub/GitLab Actions</text>
    </g>

    <!-- 3rd row -->
    <g class="node" transform="translate(1026 515)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Argo CD: Declarative Continuous Delivery</text>
    </g>
    <g class="node" transform="translate(984 515)">
      <rect x="-61" y="-22.5" width="122" height="45" rx="6"/>
      <text>Namespace A</text>
    </g>
    <g class="node" transform="translate(1204 515)">
      <rect x="-61" y="-22.5" width="122" height="45" rx="6"/>
      <text>Namespace B</text>
    </g>
    <g class="node" transform="translate(1424 515)">
      <rect x="-61" y="-22.5" width="122" height="45" rx="6"/>
      <text>Namespace C</text>
    </g>

    <!-- 4th row -->
    <g class="node" transform="translate(757 673)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Kubernetes Cluster: NixOS nodes</text>
    </g>

    <!-- 5th row (infra add-ons) -->
    <g class="node" transform="translate(631 831)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>MetalLB / Cilium / cert-manager</text>
    </g>
    <g class="node" transform="translate(908 831)">
      <rect x="-111" y="-22.5" width="222" height="45" rx="6"/>
      <text>External-DNS / CSI storage</text>
    </g>
    <g class="node" transform="translate(1141 831)">
      <rect x="-72" y="-22.5" width="144" height="45" rx="6"/>
      <text>HPA / VPA / PDB</text>
    </g>
    <g class="node" transform="translate(1379 831)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>PodSecurityPolicies / OPA Gatekeeper</text>
    </g>
    <g class="node" transform="translate(1616 831)">
      <rect x="-71" y="-22.5" width="142" height="45" rx="6"/>
      <text>DSPy Jobs: Cron</text>
    </g>
    <g class="node" transform="translate(1804 831)">
      <rect x="-66" y="-22.5" width="133" height="45" rx="6"/>
      <text>Game Services</text>
    </g>

    <!-- Observability leaf nodes -->
    <g class="node" transform="translate(124 990)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Prometheus ‚Üí Grafana dashboards</text>
    </g>
    <g class="node" transform="translate(375 990)">
      <rect x="-85" y="-22.5" width="171" height="45" rx="6"/>
      <text>Loki / Tempo traces</text>
    </g>
    <g class="node" transform="translate(622 990)">
      <rect x="-111" y="-22.5" width="222" height="45" rx="6"/>
      <text>Alertmanager ‚Üí PagerDuty</text>
    </g>
    <g class="node" transform="translate(899 990)">
      <rect x="-116" y="-33" width="232" height="66" rx="6"/>
      <text>Policy-as-code: OPA / Kyverno</text>
    </g>

    <!-- ======  EDGES  ====== -->
    <!-- Git ‚Üí CI -->
    <path d="M1979 74L1026 166" class="edge" marker-end="url(#ah)"/>
    <text x="1502" y="120" class="edge-label">Pull-Request ‚Üí Review ‚Üí Merge</text>

    <!-- CI ‚Üí Argo CD -->
    <path d="M1026 232L1026 324" class="edge" marker-end="url(#ah)"/>
    <text x="1046" y="278" class="edge-label">Promotes validated artefacts</text>

    <!-- Argo CD ‚Üí K8s -->
    <path d="M1026 390L757 482" class="edge" marker-end="url(#ah)"/>
    <text x="891" y="445" class="edge-label">K8s manifests: Kustomize/Helm</text>

    <!-- Argo CD ‚Üí Namespaces -->
    <path d="M984 423L984 482" class="edge" marker-end="url(#ah)"/>
    <path d="M1204 423L1204 482" class="edge" marker-end="url(#ah)"/>
    <path d="M1424 423L1424 482" class="edge" marker-end="url(#ah)"/>

    <!-- K8s ‚Üí Add-ons -->
    <path d="M631 548L631 640" class="edge" marker-end="url(#ah)"/>
    <path d="M908 548L908 640" class="edge" marker-end="url(#ah)"/>
    <path d="M1141 548L1141 640" class="edge" marker-end="url(#ah)"/>
    <path d="M1379 548L1379 640" class="edge" marker-end="url(#ah)"/>
    <path d="M1616 548L1616 640" class="edge" marker-end="url(#ah)"/>
    <path d="M1804 548L1804 640" class="edge" marker-end="url(#ah)"/>

    <!-- K8s ‚Üí Observability -->
    <path d="M757 708L373 800" class="edge" marker-end="url(#ah)"/>

    <!-- Observability ‚Üí leaf nodes -->
    <path d="M124 865L124 957" class="edge" marker-end="url(#ah)"/>
    <path d="M375 865L375 957" class="edge" marker-end="url(#ah)"/>
    <path d="M622 865L622 957" class="edge" marker-end="url(#ah)"/>
    <path d="M899 865L899 957" class="edge" marker-end="url(#ah)"/>

    <!-- Git ‚Üí side nodes -->
    <path d="M1979 90L1301 166" class="edge" marker-end="url(#ah)"/>
    <path d="M1979 105L1559 166" class="edge" marker-end="url(#ah)"/>
    <path d="M1982 120L1823 166" class="edge" marker-end="url(#ah)"/>
    <path d="M2100 120L2105 166" class="edge" marker-end="url(#ah)"/>
    <path d="M2209 120L2367 166" class="edge" marker-end="url(#ah)"/>
  </svg>

  <!-- ========= Tiny JS for zoom/pan ========= -->
  <script>
  (() => {
    const svg   = document.getElementById('flowchart');
    const box   = svg.viewBox.baseVal;
    let scale = 1, tx = 0, ty = 0;
    function update() {
      svg.style.transformOrigin = '0 0';
      svg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
    }
    document.getElementById('zoomIn').onclick  = () => { scale *= 1.2; update(); };
    document.getElementById('zoomOut').onclick = () => { scale /= 1.2; update(); };
    document.getElementById('zoomFit').onclick = () => { scale = 1; tx = ty = 0; update(); };

    // mouse-drag pan
    let dragging = false, sx, sy;
    svg.addEventListener('mousedown', e => { dragging = true; sx = e.clientX - tx; sy = e.clientY - ty; });
    window.addEventListener('mousemove', e => {
      if (!dragging) return;
      tx = e.clientX - sx; ty = e.clientY - sy;
      update();
    });
    window.addEventListener('mouseup', () => dragging = false);
  })();
  </script>
</section>
  <hr>

  <h2>5. A Day in the Life of a Change</h2>
  <p>Let‚Äôs add a new feature: ‚ÄúShow real-time in-game leaderboards‚Äù.</p>
  <ol>
    <li><strong>Code</strong>
      <ul>
        <li>Write the leaderboard service in Go.</li>
        <li>Add a DSPy pipeline to pre-aggregate stats.</li>
        <li>Commit everything to git.</li>
      </ul>
    </li>
    <li><strong>CI Gate</strong>
      <ul>
        <li>Nix builds the Docker image (bit-for-bit reproducible).</li>
        <li>Terraform dry-run shows a new Redis cache.</li>
        <li>Tests pass ‚Üí image is signed &amp; pushed.</li>
      </ul>
    </li>
    <li><strong>GitOps Sync</strong>
      <ul>
        <li>Argo CD detects the new commit hash.</li>
        <li>Kubernetes manifests are applied; pods roll out blue-green.</li>
        <li>OPA policy ensures the service can‚Äôt talk to the payments DB.</li>
      </ul>
    </li>
    <li><strong>Observe</strong>
      <ul>
        <li>Prometheus sees p95 latency drop.</li>
        <li>Grafana dashboard auto-updates.</li>
        <li>No humans touched a server.</li>
      </ul>
    </li>
  </ol>

  <hr>

  <h2>6. Beginner Take-aways</h2>
  <ul>
    <li><strong>Start small:</strong> Put one service in Docker, store its manifest in Git, and let Argo CD sync it.</li>
    <li><strong>Lean on NixOS for dev laptops</strong> ‚Äì <code>nix develop</code> gives the exact same tools as prod.</li>
    <li><strong>Policies early:</strong> A 15-line OPA rule today prevents a 3 a.m. breach tomorrow.</li>
    <li><strong>Celebrate merges:</strong> Every green PR is a fully tested, policy-compliant, zero-downtime release.</li>
  </ul>

  <section id="stack-assets">
    <h3>Grab the configs</h3>
    <button id="copyBtn">üìã Copy URLs</button>
    <p>Everything below is ready to copy-paste from <code>assets/</code>.</p>
    <ol>
      <li><a href="assets/README.md" download>README.md</a> ‚Äî full walk-through &amp; quick-start guide.</li>
      <li><a href="assets/flake.nix" download>flake.nix</a> ‚Äî NixOS dev-shell with pinned Terraform, kubectl, Argo CD CLI, Docker.</li>
      <li><a href="assets/main.tf" download>main.tf</a> ‚Äî Terraform plan to spin up an EKS cluster (swap provider blocks for GCP/Azure).</li>
      <li><a href="assets/argocd-app.yaml" download>argocd-app.yaml</a> ‚Äî Argo CD Application that bootstraps Gatekeeper in <code>gatekeeper-system</code>.</li>
      <li><a href="assets/constraint-template.yaml" download>constraint-template.yaml</a> ‚Äî OPA Gatekeeper template that rejects any container image tagged <code>:latest</code>.</li>
    </ol>
  </section>

  <hr>

  <h2>7. The Bigger Picture</h2>
  <p>Declarative, Git-driven stacks aren‚Äôt tools; they‚Äôre a culture.<br>
     When everything is code, knowledge lives in the repo, not in someone‚Äôs head.<br>
     That means faster onboarding, fearless refactors, and‚Äîbest of all‚ÄîFriday deploys that don‚Äôt ruin weekends.</p>
  <p><strong>Welcome to the Declared World:</strong> where the robots do the toil, and we get back to building great games.</p>

  <hr>
  <p style="font-size:.9em;color:#9ca3af;">¬© 2025 Jonathan McGuinness</p>

  <!-- tiny inline script only for the copy button ‚Äì no impact on SVG -->
  <script>
    document.getElementById('copyBtn').addEventListener('click', () => {
      const urls = Array.from(document.querySelectorAll('#stack-assets a'))
                       .map(a => a.href).join('\n');
      navigator.clipboard.writeText(urls).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = 'üìã Copy URLs', 1500);
      });
    });
  </script>
</body>
</html>
