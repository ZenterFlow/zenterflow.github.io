<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>From Snowflake Servers to GitOps Nirvana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A beginner-friendly tour of the declarative stack that actually runs itself.">
  <meta name="keywords" content="GitOps,NixOS,Kubernetes,ArgoCD,Terraform,Docker,DSPy,OPA">
  <meta name="author" content="Jonathan McGuinness">
  <meta name="theme-color" content="#111827">

  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;
      line-height:1.6;
      margin:2rem auto;
      max-width:680px;
      padding:0 1rem;
      color:#ffffff;
      background:#111827;
    }
    h1,h2{color:#60a5fa;}
    table{width:100%;border-collapse:collapse;margin:1rem 0;}
    th,td{padding:.5rem;border:1px solid #374151;text-align:left;}
    code{background:#1f2937;padding:.15rem .35rem;border-radius:3px;}
    pre{background:#1f2937;padding:1rem;overflow-x:auto;}
    a{color:#00ff00;}a:visited{color:#22c55e;}
    img{max-width:100%;height:auto;border-radius:6px;}
    /* copy buttons */
    .copy-btn{
      color:#fff; /* white text */
      background:transparent;
      border:none;
      cursor:pointer;
      font-size:1rem;
      margin-left:.15rem;
      transition:transform .1s;
    }
    .copy-btn:hover{
      transform:scale(1.15);
    }
    .copy-icon{
      color:#fff; /* white rectangles on dark bg */
      vertical-align:middle;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  
</head>

<body>
  <h1>From Snowflake Servers to GitOps Nirvana</h1>
  <p class="tagline">
  <em>8 open-source tools you can combine so that <strong>git push</strong> deploys your entire stack.</em>
  </p>
  
  <!-- paragraph with per-link copy buttons -->
<p>
  You‚Äôve probably heard the buzzwords: GitOps, NoOps, immutable infrastructure.<br>
  Today I‚Äôd like to walk you‚Äîstep by step‚Äîthrough why these concepts exist and how a small constellation of tools
  (<a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a>,
   <a href="https://nixos.org/" target="_blank" rel="noopener">NixOS</a>,
   <a href="https://docker.com/" target="_blank" rel="noopener">Docker</a>,
   <a href="https://developer.hashicorp.com/terraform/" target="_blank" rel="noopener">Terraform</a>,
   <a href="https://kubernetes.io/" target="_blank" rel="noopener">Kubernetes</a>,
   <a href="https://argo-cd.readthedocs.io/en/stable/" target="_blank" rel="noopener">ArgoCD</a>,
   <a href="https://dspy.ai/" target="_blank" rel="noopener">DSPy</a>,
   and <a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener">OPA</a>)
  fit together to create a platform that deploys itself every time you hit <i>merge</i>.
  <button id="copyAllTools" class="copy-btn" title="Copy all tool URLs">
  <svg class="copy-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
    <rect x="3" y="3" width="10" height="10" rx="1" stroke="currentColor" stroke-width="1.4"/>
    <rect x="1" y="1" width="10" height="10" rx="1" stroke="currentColor" stroke-width="1.4"/>
  </svg>
  All
</button>
</p>
  <details class="toc">
  <summary>Quick tool map (click to open)</summary>
  <table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <td><a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a></td>
    <td><a href="https://nixos.org/" target="_blank" rel="noopener">NixOS</a></td>
    <td><a href="https://docker.com/" target="_blank" rel="noopener">Docker</a></td>
    <td><a href="https://developer.hashicorp.com/terraform/" target="_blank" rel="noopener">Terraform</a></td>
    <td><a href="https://kubernetes.io/" target="_blank" rel="noopener">Kubernetes</a></td>
    <td><a href="https://argo-cd.readthedocs.io/en/stable/" target="_blank" rel="noopener">ArgoCD</a></td>
    <td><a href="https://dspy.ai/" target="_blank" rel="noopener">DSPy</a></td>
    <td><a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener">OPA</a></td>
  </tr>
</table>

</details>

  <!-- rest of your article -->
  <h2>1. The Problem We‚Äôre Solving</h2>
  <p>In the old world, a server was a pet: lovingly hand-fed config files, patched on Sundays, and inevitably different from every other server. The result?</p>
  <ul>
    <li>‚ÄúIt works on my machine!‚Äù</li>
    <li>Snow-flake drift and 3 a.m. pages.</li>
    <li>Scaling = more pets.</li>
  </ul>

  <h2>2. The North Star: Everything as Code</h2>
  <p>Instead of pets, we want cattle - identical, replaceable, and defined in text files that live in Git.<br>
  If Git is the single source of truth, the rest of the stack becomes a conveyor belt that turns that truth into running software.</p>

  <h2>3. The Cast of Characters and Their Jobs</h2>
  <table border="1" cellpadding="8" style="border-collapse:collapse;">
    <thead><tr><th>Tool</th><th>One-Sentence Job</th><th>Why It Matters</th></tr></thead>
    <tbody>
      <tr><td><strong>Git</strong></td><td>The single source-of-truth for every line of code and config.</td><td>Immutable history + pull-requests = collaboration without chaos.</td></tr>
      <tr><td><strong>NixOS</strong></td><td>An entire Linux distro expressed in one declarative file.</td><td>Reinstalls laptop or 1 000-server fleet with <code>nixos-rebuild</code>.</td></tr>
      <tr><td><strong>Terraform</strong></td><td>Describe cloud resources (VPCs, disks, IAM) in HCL.</td><td>Re-creates an entire region from scratch in 15 min after a coffee spill.</td></tr>
      <tr><td><strong>Docker</strong></td><td>Bundle the app and its libraries into an immutable image.</td><td>Same artifact runs on your Mac, in CI, and in prod.</td></tr>
      <tr><td><strong>Argo CD</strong></td><td>A robot that watches Git and makes Kubernetes match it.</td><td>Manual <code>kubectl apply</code> is now a pull-request review.</td></tr>
      <tr><td><strong>Kubernetes</strong></td><td>The planet-scale scheduler that keeps those containers healthy.</td><td>Auto-heals, scales, and rolls out with zero downtime.</td></tr>
      <tr><td><strong>DSPy</strong></td><td>Prompt-engineering as typed, testable code.</td><td>Turns LLM prompts into reproducible pipelines.</td></tr>
      <tr><td><strong>OPA / Kyverno</strong></td><td>Policy-as-code gatekeepers for every API call.</td><td>Blocks <code>:latest</code> images or unencrypted buckets before they deploy.</td></tr>
    </tbody>
  </table>

  <h2>4. How the Characters relate to Each Other</h2>
  <p>  <!-- external SVG as image -->
  <img src="/images/DeclarativeArchitectureMermaidChart-Dark.svg" alt="Declarative GitOps workflow" style="width:100%;height:auto;border-radius:6px;border:1px solid #374151;">
    <p style="margin-top:.25rem;font-size:.8em;color:#9ca3af;">
  üí° Press <kbd>Ctrl</kbd> + <kbd>+</kbd> / <kbd>-</kbd>, or pinch-zoom on mobile to enlarge the diagram.
</p>
    
  <h2>5. A Day in the Life of a Change</h2>
  <p>Let‚Äôs add a new feature: ‚ÄúShow real-time in-game leaderboards‚Äù.</p>
  <ol>
    <li><strong>Code</strong>
      <ul>
        <li>Write the leaderboard service in Go.</li>
        <li>Add a DSPy pipeline to pre-aggregate stats.</li>
        <li>Commit everything to git.</li>
      </ul>
    </li>
    <li><strong>CI Gate</strong>
      <ul>
        <li>Nix builds the Docker image (bit-for-bit reproducible).</li>
        <li>Terraform dry-run shows a new Redis cache.</li>
        <li>Tests pass ‚Üí image is signed & pushed.</li>
      </ul>
    </li>
    <li><strong>GitOps Sync</strong>
      <ul>
        <li>Argo CD detects the new commit hash.</li>
        <li>Kubernetes manifests are applied; pods roll out blue-green.</li>
        <li>OPA policy ensures the service can‚Äôt talk to the payments DB.</li>
      </ul>
    </li>
    <li><strong>Observe</strong>
      <ul>
        <li>Prometheus sees p95 latency drop.</li>
        <li>Grafana dashboard auto-updates.</li>
        <li>No humans touched a server.</li>
      </ul>
    </li>
  </ol>

  <h2>6. Beginner Take-aways</h2>
  <ul>
    <li>Start small: Put one service in Docker, store its manifest in Git, and let Argo CD sync it.</li>
    <li>Lean on NixOS for dev laptops - <code>nix develop</code> gives the exact same tools as prod.</li>
    <li>Policies early: A 15-line OPA rule today prevents a 3 a.m. breach tomorrow.</li>
    <li>Celebrate merges: Every green PR is a fully tested, policy-compliant, zero-downtime release.</li>
  </ul>

  <!-- assets list + copy button -->
<!-- ===== Grab the configs ===== -->
<section id="stack-assets">
  <h3>üì¶ Grab the configs</h3>
  <button onclick="copyAssets()" class="copy-btn">
    <svg class="copy-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <rect x="3" y="3" width="10" height="10" rx="1" stroke="currentColor" stroke-width="1.4"/>
      <rect x="1" y="1" width="10" height="10" rx="1" stroke="currentColor" stroke-width="1.4"/>
    </svg>
    Copy URLs
  </button>

  <ul style="padding-left: 0;">

  <!-- README.md -->
  <li class="file-block">
    <div class="file-header">
      <a href="assets/README.md" download>‚¨á Download README.md</a>
      <details>
        <summary>Show Code</summary>
        <div class="code-container">
          <button class="copy-btn" data-target="file-1">Copy</button>
          <pre><code id="file-1" class="language-markdown"># Reproducible Stack in 5 Steps

| Step | Tech        | One-liner Purpose                        |
|------|-------------|------------------------------------------|
| 1    | NixOS       | Immutable host OS                        |
| 2    | Terraform   | Provision K8s cluster                    |
| 3    | Docker      | Local dev parity                         |
| 4    | Argo CD     | GitOps continuous delivery               |
| 5    | OPA Gatekeeper | Policy guardrails                     |

## Quickstart
1. `nix develop` ‚Äì drops you into a shell with Terraform, kubectl, Argo CD CLI.  
2. `terraform init && terraform apply` ‚Äì spins up managed K8s.  
3. `kubectl apply -f argocd-app.yaml` ‚Äì bootstraps Argo CD.  
4. `kubectl apply -f constraint-template.yaml` ‚Äì sample ‚Äúno latest tag‚Äù policy.  
</code></pre>
        </div>
      </details>
    </div>
  </li>

  <!-- flake.nix -->
  <li class="file-block">
    <div class="file-header">
      <a href="assets/flake.nix" download>‚¨á Download flake.nix</a>
      <details>
        <summary>Show Code</summary>
        <div class="code-container">
          <button class="copy-btn" data-target="file-2">Copy</button>
          <pre><code id="file-2" class="language-nix">{
  description = "Reproducible Dev Shell";

  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";
  inputs.flake-utils.url = "github:numtide/flake-utils";

  outputs = { self, nixpkgs, flake-utils }:
    flake-utils.lib.eachDefaultSystem (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        devShells.default = pkgs.mkShell {
          packages = with pkgs; [
            terraform
            kubectl
            argocd
            docker
          ];
        };
      });
}</code></pre>
        </div>
      </details>
    </div>
  </li>

  <!-- main.tf -->
  <li class="file-block">
    <div class="file-header">
      <a href="assets/main.tf" download>‚¨á Download main.tf</a>
      <details>
        <summary>Show Code</summary>
        <div class="code-container">
          <button class="copy-btn" data-target="file-3">Copy</button>
          <pre><code id="file-3" class="language-hcl">provider "kubernetes" {
  config_path = "~/.kube/config"
}

resource "kubernetes_namespace" "example" {
  metadata {
    name = "example-namespace"
  }
}</code></pre>
        </div>
      </details>
    </div>
  </li>

  <!-- argocd-app.yaml -->
  <li class="file-block">
    <div class="file-header">
      <a href="assets/argocd-app.yaml" download>‚¨á Download argocd-app.yaml</a>
      <details>
        <summary>Show Code</summary>
        <div class="code-container">
          <button class="copy-btn" data-target="file-4">Copy</button>
          <pre><code id="file-4" class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: example-app
  namespace: argocd
spec:
  destination:
    namespace: default
    server: https://kubernetes.default.svc
  source:
    repoURL: https://github.com/example/repo.git
    path: manifests
  project: default
  syncPolicy:
    automated: {}</code></pre>
        </div>
      </details>
    </div>
  </li>

  <!-- constraint-template.yaml -->
  <li class="file-block">
    <div class="file-header">
      <a href="assets/constraint-template.yaml" download>‚¨á Download constraint-template.yaml</a>
      <details>
        <summary>Show Code</summary>
        <div class="code-container">
          <button class="copy-btn" data-target="file-5">Copy</button>
          <pre><code id="file-5" class="language-yaml">apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: k8sallowedrepos
spec:
  crd:
    spec:
      names:
        kind: K8sAllowedRepos
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package k8sallowedrepos

        violation[{"msg": msg}] {
          input.review.object.spec.containers[_].image != "allowed/repo"
          msg := "Image repository is not allowed"
        }</code></pre>
        </div>
      </details>
    </div>
  </li>

</ul>

<style>
ul { list-style: none; margin: 0; }
.file-block { margin-bottom: 1.5em; }
.file-header { display: flex; flex-direction: column; gap: 0.5em; }
.file-header a { color: #00d4ff; text-decoration: none; font-weight: bold; }
details summary { cursor: pointer; color: #00d4ff; font-size: 0.9em; }
.code-container { position: relative; margin-top: 8px; }
pre { background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; overflow-x: auto; margin: 0; font-size: 0.9em; }
.copy-btn {
  position: absolute; top: 8px; right: 8px;
  background: #333; color: #fff; border: none;
  padding: 6px 10px; border-radius: 4px;
  font-size: 0.8em; cursor: pointer;
}
.copy-btn:hover { background: #444; }
</style>

<script>
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('copy-btn')) {
    const targetId = e.target.getAttribute('data-target');
    const code = document.getElementById(targetId).innerText;
    navigator.clipboard.writeText(code).then(() => {
      e.target.textContent = 'Copied!';
      setTimeout(() => e.target.textContent = 'Copy', 1500);
    });
  }
});
</script>

</section>

  <h2>7. The Bigger Picture</h2>
  <p>Declarative, Git-driven stacks aren‚Äôt tools; they‚Äôre a culture.<br>
     When everything is code, knowledge lives in the repo, not in someone‚Äôs head.<br>
     That means faster onboarding, fearless refactors, and - best of all - Friday deploys that don‚Äôt ruin weekends.</p>
  <p><strong>Welcome to the Declared World: where the robots do the toil, and we get back to building great games.</strong></p>

  <!-- JavaScript for copy buttons -->
  <script>
  function copyUrl(url) {
    navigator.clipboard.writeText(url).then(() => {
      const btn = event.target;
      btn.textContent = '‚úÖ';
      setTimeout(() => btn.textContent = 'CC', 800);
    });
  }
  function copyAssets() {
    const urls = Array.from(document.querySelectorAll('#stack-assets a')).map(a => a.href).join('\n');
    navigator.clipboard.writeText(urls).then(() => {
      const btn = event.target;
      btn.textContent = '‚úÖ Copied!';
      setTimeout(() => btn.textContent = 'CC Copy URLs', 1200);
    });
  }
  document.getElementById('copyAllTools').addEventListener('click', () => {
    const urls = [
  'https://git-scm.com/',
  'https://nixos.org/',
  'https://docker.com/',
  'https://developer.hashicorp.com/terraform/',
  'https://kubernetes.io/',
  'https://argo-cd.readthedocs.io/en/stable/',
  'https://dspy.ai/',
  'https://www.openpolicyagent.org/'
].join('\n');
    navigator.clipboard.writeText(urls).then(() => {
      const btn = document.getElementById('copyAllTools');
      btn.textContent = '‚úÖ Copied!';
      setTimeout(() => btn.textContent = 'CC All', 1200);
    });
  });
  </script>
</body>
</html>
